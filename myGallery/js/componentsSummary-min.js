const AppCard={template:'\n<div class="card" \nv-if="listInfo.loadedCardSet.has(card)"\nv-show="searchInfo.matchCardSet.has(card)"\n:data-show="searchInfo.matchCardSet.has(card)"\n:data-index="index" \n>\n\x3c!-- 图片类(内容区) --\x3e\n<img class="content"\nv-if="card.urlPicType==\'img\'"\n:alt="card.Content"\n:title="card.Content"\nv-lazy="card.showUrl"\nsrcset="" \n>\n\x3c!-- 视频类(内容区) --\x3e\n<video class="content"\ncontrols loop \ncontrolslist="nofullscreen noremoteplayback" \ndisablepictureinpicture\nv-if="card.urlPicType==\'video\'"\nv-lazy="card.showUrl"\n:title="card.Content"\n></video>\n\x3c!-- title区 --\x3e\n<div class="title">\n<div class="linkBox" v-cloak>\n<a :href="card.LinkUrl" target="_blank" v-cloak>{{card.Content}}</a>\n</div>\n</div>\n\n\x3c!-- 遮罩(插入位置视觉提示器) --\x3e\n<div class="card-mask">\n<div data-hover="false" class="card-mask-left card-mask-public"></div>\n<div data-hover="false" class="card-mask-right card-mask-public"></div>\n</div>\n</div>\n',props:{card:Object,index:Number,listInfo:Object,selectingInfo:Object,searchInfo:Object},emits:[],updated(){this.card.index=this.index},methods:{},directives:{lazy:{mounted(e,t,n){e.dataset.show=!1;let i=t.value;new IntersectionObserver(((t,n)=>{t.forEach((t=>{if(t.isIntersecting)if(n.unobserve(e),e.src=i,"IMG"==e.tagName)if(e.complete)e.dataset.show=!0;else{function o(){e.dataset.show=!0,e.removeEventListener("load",o),e.removeEventListener("error",o)}e.addEventListener("load",o),e.addEventListener("error",o)}else e.dataset.show=!0}))}),{root:document.querySelector("#listPage"),rootMargin:"10%"}).observe(e)}}}},AppThumbBox={template:'\n<div class="thumb-box" \nv-if="listInfo.loadedCardSet.has(card)"\nv-show="searchInfo.matchCardSet.has(card)"\n>\n\n\x3c!-- 缩略图内容 --\x3e\n\x3c!-- 图片类型 --\x3e\n<img class="thumb-content" alt="" \nv-if="card.urlPicType==\'img\'"   \nv-lazy="card.PicUrl">\n\n\x3c!-- 视频类型 --\x3e\n<video class="thumb-content" disablepictureinpicture \nv-if="card.urlType==\'video\'"   \nv-lazy="card.LinkUrl"></video>\n\n</div>\n',props:{card:Object,listInfo:Object,selectingInfo:Object,searchInfo:Object},directives:{lazy:{mounted(e,t,n){e.dataset.show=!1;let i=t.value;new IntersectionObserver(((t,n)=>{t.forEach((t=>{if(t.isIntersecting)if(n.unobserve(e),e.src=i,"IMG"==e.tagName)if(e.complete)e.dataset.show=!0;else{function o(){e.dataset.show=!0,e.removeEventListener("load",o),e.removeEventListener("error",o)}e.addEventListener("load",o),e.addEventListener("error",o)}else e.dataset.show=!0}))}),{rootMargin:"10%"}).observe(e)}}}},AppSearchBox={template:'\n<div class="search-container">\n<div class="search-box">\n<a class="search-btn">\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" fill="#888888"/></svg>\n</a>\n<input type="text" class="search-txt" placeholder="搜索" \nv-model="content" @keyup.enter="sendSearchResult"/>\n<div class="search-line"></div>\n<div class="search-btn-count" v-show="content!=\'\'">{{getMatchCount}}</div>\n<button class="clean-content" @click="clean">\n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.59 7L12 10.59L8.41 7L7 8.41L10.59 12L7 15.59L8.41 17L12 13.41L15.59 17L17 15.59L13.41 12L17 8.41L15.59 7Z" fill="black"/>\n</svg>\n</button>\n</div>\n</div> \n',props:{cardInfoList:Array},emits:["returnMatchInfo"],data:()=>({content:"",oldContent:"",matchTags:[],matchCardSet:new Set,matchCount:0}),methods:{sendSearchResult(){this.getMatchIndexList(this.matchTags),this.$emit("returnMatchInfo",{matchTags:this.matchTags,matchCardSet:this.matchCardSet})},getMatchIndexList(e=[]){this.cardInfoList.forEach((t=>{let n=!1;if(e.length>0)for(let i=0,o=e.length;i<o;i++){const o=e[i];(t.Content.toLowerCase().includes(o.toLowerCase())||t.index+1==Number(o))&&(n=!0)}else n=!0;n?this.matchCardSet.add(t):this.matchCardSet.delete(t)}))},clean(){this.content="",this.matchCount=0,this.matchCardSet=new Set(this.cardInfoList),this.$emit("returnMatchInfo",{matchTags:this.matchTags,matchCardSet:this.matchCardSet})}},computed:{getMatchCount(){return this.cardInfoList.filter((e=>{let t=!1;if(this.matchTags.length>0)for(let n=0,i=this.matchTags.length;n<i;n++){const i=this.matchTags[n];(e.Content.toLowerCase().includes(i.toLowerCase())||e.index+1==Number(i))&&(t=!0)}else t=!0;return t})).length}},watch:{content(e,t){e!=t&&(e.includes("|")?this.matchTags=e.split("|"):this.matchTags[0]=e)}},mounted(){this.getMatchIndexList(),this.sendSearchResult()}},AppPreViewer={components:{AppThumbBox:AppThumbBox},template:'\n<div id="preViewer" ref="preViewerInner"\n:data-show="info.show" \n:data-now-index="info.nowIndex" \n:data-show-type="info.showType" \n@mousedown="clickToClose"\n@dblclick="dblClickToClose" \n@mousewheel.passive="turnPageByRoll" v-cloak>\n\n<span id="messageInViewer" v-cloak>\n({{Number(info.nowIndex)+1}}/{{cardInfoList.length}})<br>\n{{message.content}}\n</span>\n\n\x3c!-- 悬浮按钮菜单 --\x3e\n<div class="preViewer-menu">\n\n\x3c!-- 缩略图导航栏切换按钮 --\x3e\n<div class="open-thumbnail-track" \n:data-open="btn.openThumbTrackBtn" \n@click="switchThumbnailTrack">\n<svg width="48" height="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n<path\nd="M18 20C16.8954 20 16 19.1046 16 18C16 16.8954 16.8954 16 18 16C19.1046 16 20 16.8954 20 18C20 19.1046 19.1046 20 18 20ZM12 20C10.8954 20 10 19.1046 10 18C10 16.8954 10.8954 16 12 16C13.1046 16 14 16.8954 14 18C14 19.1046 13.1046 20 12 20ZM6 20C4.89543 20 4 19.1046 4 18C4 16.8954 4.89543 16 6 16C7.10457 16 8 16.8954 8 18C8 19.1046 7.10457 20 6 20ZM18 14C16.8954 14 16 13.1046 16 12C16 10.8954 16.8954 10 18 10C19.1046 10 20 10.8954 20 12C20 12.5304 19.7893 13.0391 19.4142 13.4142C19.0391 13.7893 18.5304 14 18 14ZM12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12C14 12.5304 13.7893 13.0391 13.4142 13.4142C13.0391 13.7893 12.5304 14 12 14ZM6 14C4.89543 14 4 13.1046 4 12C4 10.8954 4.89543 10 6 10C7.10457 10 8 10.8954 8 12C8 12.5304 7.78929 13.0391 7.41421 13.4142C7.03914 13.7893 6.53043 14 6 14ZM18 8C16.8954 8 16 7.10457 16 6C16 4.89543 16.8954 4 18 4C19.1046 4 20 4.89543 20 6C20 6.53043 19.7893 7.03914 19.4142 7.41421C19.0391 7.78929 18.5304 8 18 8ZM12 8C10.8954 8 10 7.10457 10 6C10 4.89543 10.8954 4 12 4C13.1046 4 14 4.89543 14 6C14 6.53043 13.7893 7.03914 13.4142 7.41421C13.0391 7.78929 12.5304 8 12 8ZM6 8C4.89543 8 4 7.10457 4 6C4 4.89543 4.89543 4 6 4C7.10457 4 8 4.89543 8 6C8 6.53043 7.78929 7.03914 7.41421 7.41421C7.03914 7.78929 6.53043 8 6 8Z"\nfill="black" />\n</svg>\n</div>\n\x3c!-- 图片定位按钮 --\x3e\n<div class="targetLocate" \n@click="toLocateTarget">\n<svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path\nd="M12 21C10.7369 19.9226 9.56619 18.7415 8.5 17.469C6.9 15.558 5 12.712 5 9.99999C4.99858 7.16754 6.70425 4.61338 9.32107 3.52939C11.9379 2.44539 14.9501 3.04523 16.952 5.04899C18.2685 6.3596 19.0059 8.14238 19 9.99999C19 12.712 17.1 15.558 15.5 17.469C14.4338 18.7415 13.2631 19.9226 12 21ZM12 6.99999C10.9282 6.99999 9.93782 7.57179 9.40193 8.49999C8.86603 9.42819 8.86603 10.5718 9.40193 11.5C9.93782 12.4282 10.9282 13 12 13C13.6569 13 15 11.6568 15 9.99999C15 8.34313 13.6569 6.99999 12 6.99999Z"\nfill="black" />\n</svg>\n</div>\n\n</div>\n\n\x3c!-- 展示区 --\x3e\n<div id="displayArea">\n\n\x3c!-- 图片播放器 --\x3e\n<div id="picShowBoard" ref="picShowBoard"\n:style="{\n\'aspect-ratio\': info.showCard != null? info.showCard.scale : \'auto\',\nleft: info.style.left,\ntop: info.style.top,\nwidth: info.style.width,\nheight: info.style.height,\n}" \n@mousedown="mousedownViewer" \n@mousewheel.passive="zoomViewer">\n\n\x3c!-- 内容区img --\x3e\n\x3c!-- <img id="showPic" alt="" ref="showPic"\n\t\t\t\tdata-show="false"\n:src="info.picShowBoardUrl"\n\t\t\t\t> --\x3e\n\n</div>\n\n\x3c!-- 视频播放器 --\x3e\n<div id="videoPlayer" \n:style="{\n\'aspect-ratio\': info.showCard != null? info.showCard.scale : \'auto\',\nleft: info.style.left,\ntop: info.style.top,\nwidth: info.style.width,\nheight: info.style.height,\n}" >\n\n\x3c!-- 内容区video --\x3e\n<video id="showVideo" ref="showVideo" controls loop="loop"\n\t\t\t\tdata-show="false"\n:src="info.videoPlayerUrl" ></video>\n\n</div>\n\n</div>\n\n\x3c!-- 前一张 --\x3e\n<span class="pv-pic-window-pre" \n@click="turnPage(0)">\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n<g data-name="Layer 2">\n<g data-name="arrow-left">\n<rect width="24" height="24" opacity="0" />\n<path\nd="M13.54 18a2.06 2.06 0 0 1-1.3-.46l-5.1-4.21a1.7 1.7 0 0 1 0-2.66l5.1-4.21a2.1 2.1 0 0 1 2.21-.26 1.76 1.76 0 0 1 1.05 1.59v8.42a1.76 1.76 0 0 1-1.05 1.59 2.23 2.23 0 0 1-.91.2z" />\n</g>\n</g>\n</svg>\n</span>\n\x3c!-- 后一张 --\x3e\n<span class="pv-pic-window-next" \n@click="turnPage(1)">\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n<g data-name="Layer 2">\n<g data-name="arrow-right">\n<rect width="24" height="24" transform="rotate(180 12 12)" opacity="0" />\n<path\nd="M10.46 18a2.23 2.23 0 0 1-.91-.2 1.76 1.76 0 0 1-1.05-1.59V7.79A1.76 1.76 0 0 1 9.55 6.2a2.1 2.1 0 0 1 2.21.26l5.1 4.21a1.7 1.7 0 0 1 0 2.66l-5.1 4.21a2.06 2.06 0 0 1-1.3.46z" />\n</g>\n</g>\n</svg>\n</span>\n\n\x3c!-- 底部图片缩略图区域 --\x3e\n<div id="thumbnail-viewport" \n:style="{\n\'scroll-snap-type\':thumbnailViewport.style[\'scroll-snap-type\'],\nheight:thumbnailViewport.height+\'px\'\n}">\n\x3c!-- 缩略图轨道 --\x3e\n<div id="thumbnail-track">\n\x3c!-- 缩略图容器 --\x3e\n<app-thumb-box v-for="(card, index) in cardInfoList" :key="card.id"\n:card="card" :data-index="index"\n:listInfo="listInfo"\n:selectingInfo="selectingInfo" \n:searchInfo="searchInfo" \n:data-selected="index==info.nowIndex"\n:style="{\n\'--scale\':card.scale,\n}"\n\t\t\t\t@click="()=>{toShow(index)}"\n></app-thumb-box>\n\n</div>\n\n</div>\n\n</div>\n',props:{cardInfoList:Object,matchIndexList:Object,onceLoadMaxCount:Number,listInfo:Object,selectingInfo:Object,searchInfo:Object},emits:["requestLoadCard","returnNowPreviewIndex"],data:()=>({info:{nowIndex:-1,showCard:null,previousIndex:-1,show:!1,showType:"none",imgEle:null,videoPlayerUrl:"",width:0,height:0,style:{"aspect-ratio":"auto",left:"auto",top:"auto",width:"auto",height:"auto"}},btn:{openThumbTrackBtn:!1},message:{content:""},thumbnailViewport:{height:150,style:{"scroll-snap-type":null}}}),methods:{toShow(e){this.info.nowIndex=e,null!=window.event&&window.event.target.blur(),this.$el.focus();const t=this.cardInfoList[e];this.message.content=this.cardInfoList[this.info.nowIndex].Content,this.info.width=t.Width,this.info.height=t.Height,this.info.style["aspect-ratio"]=t.scale,this.info.show=!0,this.info.showCard=t,this.info.imgEle=null,this.$refs.picShowBoard.innerHTML="",this.info.picShowBoardUrl="",this.info.videoPlayerUrl="",this.info.imgEle=document.createElement("img"),this.info.imgEle.id="showPic",this.info.imgEle.dataset.show=!1,this.$refs.picShowBoard.appendChild(this.info.imgEle);const n=this.$refs.showVideo;n.dataset.show=!1,"img"===t.urlType?(this.info.imgEle.src=t.LinkUrl,this.info.videoPlayerUrl="",this.info.showType="img"):"video"===t.urlType?(this.info.imgEle.src="",this.info.videoPlayerUrl=t.LinkUrl,this.info.showType="video"):"img"===t.urlPicType?(this.info.imgEle.src=t.PicUrl,this.info.videoPlayerUrl="",this.info.showType="img"):"video"===t.urlPicType?(this.info.imgEle.src="",this.info.videoPlayerUrl=t.PicUrl,this.info.showType="video"):this.info.showType="none","img"===this.info.showType&&(this.info.imgEle.complete?setTimeout((()=>this.info.imgEle.dataset.show=!0)):this.info.imgEle.onload=()=>{null!=this.info.imgEle&&(this.info.imgEle.dataset.show=!0)}),"video"===this.info.showType&&(n.oncanplay=()=>{n.dataset.show=!0,this.videoPlayerControl("play")}),this.toCenter(),this.$emit("returnNowPreviewIndex",e),document.addEventListener("keydown",this.keyboardViewer),document.addEventListener("wheel",this.wheelInViewer,{passive:!0}),window.addEventListener("resize",this.windowReSize,{passive:!0})},windowReSize(){this.toCenter(this.info.nowIndex)},toCenter(){const e=document.documentElement;let t=e.clientWidth,n=e.clientHeight;!0===this.btn.openThumbTrackBtn&&(n-=this.thumbnailViewport.height);let i=this.cardInfoList[this.info.nowIndex].scale;const o=.94;let a,s;o*n*i>t?(a=o*t,s=a/i):(s=o*n,a=s*i),this.info.style.left=.5*(t-a)+"px",this.info.style.top=.5*(n-s+20)+"px",this.info.style.width=a+"px",this.info.style.height=s+"px",this.toCenterThumbBox()},clickToClose(e){"preViewer"===e.target.id&&this.closeViewer()},dblClickToClose(e){"showPic"!==e.target.id&&"picShowBoard"!==e.target.id&&"thumbnail-viewport"!==e.target.id||this.closeViewer()},closeViewer(e=!1){this.info.imgEle=null,this.$refs.picShowBoard.innerHTML="",this.info={nowIndex:-1,show:!1,showType:"none",imgEle:null,videoPlayerUrl:"",width:0,height:0,style:{"aspect-ratio":"auto",left:"auto",top:"auto",width:"auto",height:"auto"}},this.message={content:"",nowNum:1},document.removeEventListener("keydown",this.keyboardViewer),document.removeEventListener("wheel",this.wheelInViewer),window.removeEventListener("resize",this.windowReSize),this.videoPlayerControl("pause"),e||this.$emit("returnNowPreviewIndex",-1)},mousedownViewer(e){let t=e.target;if("picShowBoard"!=t.id&&(t=t.parentNode,"picShowBoard"!=t.id))return;t.dataset.dragging=!0;const n=this.info;let i=t.getBoundingClientRect(),o=window.event.clientX,a=window.event.clientY;function s(){const e=window.event.clientX-o,t=window.event.clientY-a;n.style.left=i.left+e+"px",n.style.top=i.top+t+"px"}document.addEventListener("mousemove",s),document.addEventListener("mouseup",(function e(){t.dataset.dragging=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e)}))},zoomViewer(e,t=.5){let n=(e=e||window.event).clientX,i=e.clientY,o=document.querySelector("#picShowBoard").getBoundingClientRect();document.querySelector("#showPic").getBoundingClientRect();const a=document.documentElement;let s=this.cardInfoList[this.info.nowIndex].scale;if(e.wheelDelta>0){let e=1.5*t,r=o.height*(1+e);r<20*a.clientHeight&&(this.info.style.top=o.top-(i-o.top)*e+"px",this.info.style.left=o.left-(n-o.left)*e+"px",this.info.style.height=r+"px",this.info.style.width=r*s+"px")}else{let e=t,r=o.height*(1-e);r>.15*a.clientHeight&&(this.info.style.top=o.top+(i-o.top)*e+"px",this.info.style.left=o.left+(n-o.left)*e+"px",this.info.style.height=r+"px",this.info.style.width=r*s+"px")}},toLocateTarget(){const e=document.querySelector(`.card[data-index="${this.info.nowIndex}"]`);this.closeViewer(!0);let t={behavior:"smooth",block:"center",inline:"center"};if(null!=e){this.thumbnailViewport.style["scroll-snap-type"]="none",e.scrollIntoView(t),setTimeout((()=>{this.thumbnailViewport.style["scroll-snap-type"]=null}),1e3);document.querySelector("#list");setTimeout(this.$emit("returnNowPreviewIndex",-1),0)}},switchThumbnailTrack(){this.btn.openThumbTrackBtn=!this.btn.openThumbTrackBtn,this.toCenter()},toCenterThumbBox(){if(0==this.info.show)return;let e;e=document.querySelector("#thumbnail-track").querySelector(`.thumb-box[data-index="${this.info.nowIndex}"]`);let t={behavior:"smooth",block:"center",inline:"center"};(-1!=this.info.previousIndex&&(0==this.info.previousIndex&&this.info.nowIndex==this.cardInfoList.length-1||this.info.previousIndex==this.cardInfoList.length-1&&0==this.info.nowIndex)||0==this.btn.openThumbTrackBtn)&&(t.behavior="instant"),this.info.previousIndex=this.info.nowIndex,null!=e&&e.scrollIntoView(t)},turnPage(e){let t=this.matchIndexList.indexOf(this.info.nowIndex);-1!=t&&(0===e&&(t>0?t--:t=this.searchInfo.matchCardSet.size-1),1===e&&(t<this.searchInfo.matchCardSet.size-1?t++:t=0),t=this.matchIndexList[t],t!=this.info.nowIndex&&this.toShow(t))},turnPageByRoll(e){"showPic"!=e.target.id&&"picShowBoard"!=e.target.id&&"showVideo"!=e.target.id&&"videoPalyer"!=e.target.id&&(e.wheelDelta>0?this.turnPage(0):this.turnPage(1))},keyboardViewer(e){this.$el.focus(),"img"==this.info.showType&&("a"!=e.key&&"ArrowLeft"!=e.key&&"ArrowUp"!=e.key||this.turnPage(0),"d"!=e.key&&"ArrowRight"!=e.key&&"ArrowDown"!=e.key||this.turnPage(1)),"video"==this.info.showType&&("q"!=e.key&&"ArrowLeft"!=e.key||!e.ctrlKey||this.turnPage(0),"e"!=e.key&&"ArrowRight"!=e.key||!e.ctrlKey||this.turnPage(1),"a"==e.key&&this.videoPlayerControl("toback",.5),"d"==e.key&&this.videoPlayerControl("toforward",.5),"q"!=e.key&&"ArrowLeft"!=e.key||e.ctrlKey||this.videoPlayerControl("toback",5),"e"!=e.key&&"ArrowRight"!=e.key||e.ctrlKey||this.videoPlayerControl("toforward",5),"w"!=e.key&&"ArrowUp"!=e.key||this.videoPlayerControl("volup"),"s"!=e.key&&"ArrowDown"!=e.key||this.videoPlayerControl("voldown")," "==e.key&&this.videoPlayerControl("switch"),"m"==e.key&&this.videoPlayerControl("mute"))},wheelInViewer(e){"showVideo"==e.target.id&&(e.wheelDelta>0?this.videoPlayerControl("volup"):this.videoPlayerControl("voldown"))},videoPlayerControl(e,t){const n=this.$refs.showVideo;n.blur();const i=.1;let o=5;null!=t&&(o=t),"toback"==e&&(n.currentTime-o>0?n.currentTime=n.currentTime-o:n.currentTime=0),"toforward"==e&&(n.currentTime+o<n.duration?n.currentTime=n.currentTime+o:n.currentTime=n.duration),"voldown"==e&&(n.volume=n.volume-i>=0?n.volume-i:0),"volup"==e&&(n.volume=n.volume+i<=1?n.volume+i:1),"mute"==e&&(n.muted?n.muted=!1:n.muted=!0),"pause"==e&&n.pause(),"play"==e&&n.play(),"switch"==e&&(n.paused?n.play():n.pause())}},computed:{getThumbnailViewportStyle:{get(){return this.thumbnailViewport.height+"px"}}},watch:{},directives:{},mounted(){}},AppRightClickMenu={template:'\n<div class="right-click-menu" \n:data-show="info.show" \n:style="{\ntop: info.top + \'px\',\nleft: info.left + \'px\',\n}"\n>\n\n<div class="menu-option" id="view-target"\n@click="rightClickMenu_viewTarget" >\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n<g>\n<path fill="none" d="M0 0h24v24H0z" />\n<path\nd="M1.181 12C2.121 6.88 6.608 3 12 3c5.392 0 9.878 3.88 10.819 9-.94 5.12-5.427 9-10.819 9-5.392 0-9.878-3.88-10.819-9zM12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-2a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"\nfill="green" />\n</g>\n</svg>\n预览\n</div>\n<div class="menu-option" id="open-in-new-TAB"\n@click="rightClickMenu_openInNewTAB" >\n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path\nd="M17.001 20H6.00098C4.89641 20 4.00098 19.1046 4.00098 18V7C4.00098 5.89543 4.89641 5 6.00098 5H10.001V7H6.00098V18H17.001V14H19.001V18C19.001 19.1046 18.1055 20 17.001 20ZM11.701 13.707L10.291 12.293L16.584 6H13.001V4H20.001V11H18.001V7.415L11.701 13.707Z"\nfill="black" />\n</svg>\n新标签中打开\n</div>\n<div class="menu-option" id="rename-card"\n@click="rightClickMenu_renameCard" >\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n<path d="M20.005 5.995h-1v2h1v8h-1v2h1c1.103 0 2-.897 2-2v-8c0-1.102-.898-2-2-2zm-14 4H15v4H6.005z" />\n<path\nd="M17.005 17.995V4H20V2h-8v2h3.005v1.995h-11c-1.103 0-2 .897-2 2v8c0 1.103.897 2 2 2h11V20H12v2h8v-2h-2.995v-2.005zm-13-2v-8h11v8h-11z" />\n</svg>\n重命名\n</div>\n<div class="menu-option" id="refresh-card"\n@click="rightClickMenu_refreshCard" alt="重新验证">\n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.995 4.00001C7.8362 3.99432 4.36664 7.17599 4.01299 11.3197C3.65933 15.4634 6.53955 19.187 10.6391 19.8862C14.7387 20.5853 18.6903 18.0267 19.73 14H17.649C16.6318 16.8771 13.617 18.5324 10.6434 17.8465C7.66989 17.1605 5.68488 14.3519 6.03079 11.3199C6.3767 8.28792 8.94332 5.99856 11.995 6.00001C13.5845 6.00234 15.1064 6.64379 16.218 7.78002L13 11H20V4.00001L17.649 6.35002C16.1527 4.84464 14.1175 3.99873 11.995 4.00001Z" fill="black"/>\n</svg>\n重新验证\n</div>\n<div class="menu-option" id="SetAsBackground"\n@click="rightClickMenu_setAsBackground" >\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.999 4h-16c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm-13.5 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm5.5 10h-7l4-5 1.5 2 3-4 5.5 7h-7z" fill="#007bd9"/>\n</svg>\n设为背景\n</div>\n<hr>\n<hr>\n<hr>\n<hr>\n<div class="menu-option" id="delete-card"\n@click="rightClickMenu_deleteCard" >\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n<g>\n<path fill="none" d="M0 0h24v24H0z" />\n<path\nd="M7 6V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5zm6.414 8l1.768-1.768-1.414-1.414L12 12.586l-1.768-1.768-1.414 1.414L10.586 14l-1.768 1.768 1.414 1.414L12 15.414l1.768 1.768 1.414-1.414L13.414 14zM9 4v2h6V4H9z"\nfill="#c70000" />\n</g>\n</svg>\n删除\n</div>\n\n</div>\n',props:{selectingInfo:Object},emits:["requestToShow","requestToVerifyCard","requestRemoveCard","requestSetBackGround"],data:()=>({targetCard:null,info:{show:!1,top:null,left:null}}),methods:{showMenu(e,t){const{clientX:n,clientY:i}=e;this.info.top=i,this.info.left=n,this.info.show=!0,this.targetCard=t},closeMenu(e){e.target.classList.contains("right-click-menu")||e.target.classList.contains("menu-option")||(this.info.show=!1)},rightClickMenu_viewTarget(){this.info.show=!1,this.$emit("requestToShow",this.targetCard.index)},rightClickMenu_openInNewTAB(){this.info.show=!1,window.open(this.targetCard.LinkUrl,"_blank")},rightClickMenu_renameCard(){this.info.show=!1;let e=prompt("新名称",this.targetCard.Content);null==e||/^\s*$/g.test(e)||(this.targetCard.Content=e)},rightClickMenu_refreshCard(){this.info.show=!1;let e=new Set(this.selectingInfo.cardSet);e.add(this.targetCard),e.forEach((e=>{this.$emit("requestToVerifyCard",e)}))},rightClickMenu_setAsBackground(){this.info.show=!1,this.$emit("requestSetBackGround",this.targetCard,!0)},rightClickMenu_deleteCard(){this.info.show=!1;let e,t=new Set(this.selectingInfo.cardSet);t.add(this.targetCard),e=t.size>1?`确认删除"${this.targetCard.Content}"以及,已选中${this.selectingInfo.cardSet.size}的项 (共${t.size}项)`:`确认删除"${this.targetCard.Content} (共1项)"`,confirm(e)&&t.forEach((e=>{this.$emit("requestRemoveCard",e)}))}}},AppAreaSelector={template:"\n\x3c!-- 框选box --\x3e\n<div id=\"areaSelector\" ref=\"areaSelector\"\n:style=\"{\ndisplay:info.show?null:'none',\ntop: info.top+'px',\nleft: info.left+'px',\nwidth: info.width+'px',\nheight: info.height+'px',\nposition: 'absolute',\nborder: '1px solid rgb(0,119,255)',\nbackground: 'rgba(0,119,255,0.2)',\nzIndex: '100',\n}\"></div>\n",props:{cardInfoList:Object,selectingInfo:Object,listDomSelector:String},data:()=>({mouseKey:0,startPoint:{x:0,y:0},endPoint:{x:0,y:0},ctrlKeyPressed:!1,selectedSet:new Set,tempSelectedSet:new Set,lastTimeSelectedSet:new Set,syncSelectedSet:new Set,unselectedSet:new Set,info:{show:!1,top:0,left:0,width:0,height:0}}),methods:{getRelativePositionInElement(e,t){const n=document.querySelector(this.listDomSelector),i=n.getBoundingClientRect();let o=window.getComputedStyle(n,null);const a=parseFloat(o.getPropertyValue("border-top")),s=parseFloat(o.getPropertyValue("border-left")),{left:r,top:l}=i,{scrollLeft:d,scrollTop:c,scrollWidth:h,scrollHeight:u}=n;let g=e-r+d-s,p=t-l+c-a;return g<0?g=0:g>h&&(g=h),p<0?p=0:p>u&&(p=u),{x:Math.round(g),y:Math.round(p)}},switchShowArea(e){0===e&&(this.info.show=!1),1===e&&(this.info.show=!0)},twoRectsHaveIntersection(e,t){const n=e.left,i=t.left,o=e.left+e.width,a=t.left+t.width,s=e.top,r=t.top,l=e.top+e.height,d=t.top+t.height,c=e.width,h=t.width,u=e.height,g=t.height;return!(i>o||n>a||l<r||d<s||c<=0||h<=0||u<=0||g<=0)},updateSelectItems(){const e=this.$refs.areaSelector.getBoundingClientRect();document.querySelector(this.listDomSelector).querySelectorAll(".card").forEach((t=>{const n=t.getBoundingClientRect(),i=Number(t.dataset.index),o=this.cardInfoList[i],a=this.twoRectsHaveIntersection(e,n),s=this.lastTimeSelectedSet.has(o);this.ctrlKeyPressed?a?s?this.selectingInfo.tempCardSet.delete(o):this.selectingInfo.tempCardSet.add(o):s?this.selectingInfo.tempCardSet.add(o):this.selectingInfo.tempCardSet.delete(o):a?this.selectingInfo.tempCardSet.add(o):this.selectingInfo.tempCardSet.delete(o)}))},updateArea(){const e=Math.min(this.startPoint.y,this.endPoint.y),t=Math.min(this.startPoint.x,this.endPoint.x),n=Math.abs(this.startPoint.x-this.endPoint.x),i=Math.abs(this.startPoint.y-this.endPoint.y);this.info.top=e,this.info.left=t,this.info.width=n,this.info.height=i},handleMouseDown(e){const t=document.querySelector(this.listDomSelector);if(e.button!=this.mouseKey||e.target!=t)return;const{clientX:n,clientY:i,ctrlKey:o}=e;this.ctrlKeyPressed=o,o?this.lastTimeSelectedSet=new Set(this.selectingInfo.cardSet):this.selectingInfo.tempCardSet=new Set,this.startPoint=this.getRelativePositionInElement(n,i),this.endPoint=this.startPoint,this.updateArea(),this.switchShowArea(1),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)},handleMouseMove(e){const{clientX:t,clientY:n}=e;this.endPoint=this.getRelativePositionInElement(t,n),this.updateArea(),this.updateSelectItems(),this.scrollOnDrag(t,n)},handleMouseUp(e){e.button==this.mouseKey&&(window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp),this.switchShowArea(0),this.selectingInfo.cardSet=new Set(this.selectingInfo.tempCardSet))},scrollOnDrag(e,t){const n=document.querySelector(this.listDomSelector),{x:i,y:o,width:a,height:s}=n.getBoundingClientRect();let r,l;e<i?r=e-i:e>i+a&&(r=e-(i+a)),t<o?l=t-o:t>o+s&&(l=t-(o+s)),(r||l)&&n.scrollBy({left:r,top:l,behavior:"auto"})}}},AppList={components:{AppCard:AppCard,AppPreViewer:AppPreViewer,AppSearchBox:AppSearchBox,AppRightClickMenu:AppRightClickMenu,AppAreaSelector:AppAreaSelector},template:'\n\x3c!-- list列表 --\x3e\n<div id="list" ref="list"\n:data-column-count="nowColumn"\n:style="{\n\'--column-count\':getStyle.columnCount,\n\'--card-max-height\':getStyle.cardMaxHeight,\n\'scroll-snap-type\':scrollSnapType,\n}"\n@contextmenu.prevent.native="(e)=>{e.preventDefault()}"\n@click="clickEvent"\n@mousedown="(e)=>{$refs.selector.handleMouseDown(e)}"\n@mouseup="clickEventRight"\n>\n\x3c!-- card卡片 --\x3e\n<app-card v-for="(card, index) in cardInfoList" :key="card.id"\n:card="card" \n:index="index" \n:listInfo="listInfo" \n:selectingInfo="selectingInfo" \n:searchInfo="searchInfo" \n\n:data-previewed="preViewIndex==index" \n:style="{\'--ratio\':card.scale}" \n:class="{moving:dragSorting.index==index}" \n:data-selected="selectingInfo.tempCardSet.has(card)" \n\n:draggable="dragSorting.enable" \n\n@click="cardClickEvent(card)"\n@dblclick="cardDblclickEvent(card)"\n\t\t\t@dragstart="dragStart"\n\t\t\t\n@dragover.prevent="dragEnterOrLeave" \n@dragenter.prevent="dragEnterOrLeave" \n\n\t\t\t@dragend.prevent="dragEnd"\n></app-card>\n\n\x3c!-- 框选工具 --\x3e\n<app-area-selector ref="selector"\n:cardInfoList="cardInfoList"\n:selectingInfo="selectingInfo"\n:listDomSelector="\'#list\'"\n></app-area-selector>\n</div>\n\n\x3c!-- 预览器工具 --\x3e\n<app-pre-viewer ref="preViewer"\n:cardInfoList="cardInfoList"\n:matchIndexList="getMatchIndexList"\n:onceLoadMaxCount="onceLoadMaxCount"\n:listInfo="listInfo"\n:selectingInfo="selectingInfo" \n:searchInfo="searchInfo" \n\n@requestLoadCard="(indexList)=>{verifyMultipleCard(indexList, false)}"\n@returnNowPreviewIndex="(index)=>{\n\t\t\tpreViewIndex=index\n\t\t\t\n\t\t\tverifySingleCardMandatory(cardInfoList[index],()=>{\n\t\t\t\t$refs.preViewer.toCenterThumbBox()\n\t\t\t})\n\t\t}"\n></app-pre-viewer>\n\n\x3c!-- 搜索框 --\x3e\n<app-search-box \n:cardInfoList="cardInfoList"\n@returnMatchInfo="(value)=>{searchInfo = value}"\n></app-search-box>\n\n\x3c!-- 右键菜单 --\x3e\n<app-right-click-menu ref="rightClickMenu"\n:selectingInfo="selectingInfo"\n@requestToShow="(index)=>{$refs.preViewer.toShow(index)}"\n@requestToVerifyCard="(card,updateVerify)=>{verifySingleCardMandatory(card)}"\n@requestRemoveCard="(card)=>{removeCard(card)}"\n@requestSetBackGround="(card,record)=>{sendAlterBackGroundRequest(card,record)}"\n></app-right-click-menu>\n\n',props:{cardInfoList:Object,cardDefaultaspectRatio:Number,selectingInfo:Object,regex:Object,nowColumn:Number,onceLoadMaxCount:Number,btnInfo:Object},emits:["returnListInfo","alterBackGroundRequest","requestRemoveCard"],data(){return{preViewIndex:-1,scrollSnapType:"none",listInfo:{loadingQueueList:[],visibleCardSet:new Set,loadedCardSet:new Set,unloadedCardSet:new Set(this.cardInfoList),visibleIndexListInMatched:[],unloadedIndexListInMatched:[]},searchInfo:{matchTag:[],matchCardSet:new Set},dragSorting:{enable:config.openDragSort,tempTarget:null,tempTargetIndicator:null,index:null,targetIndex:null,item:null}}},computed:{getStyle(){let e={columnCount:this.nowColumn,cardMaxHeight:"calc((100vh - 69px - 8px * (var(--column-count) - 1)) / var(--column-count))"};return this.nowColumn<=0&&(e.cardMaxHeight="1000%"),e},getMatchIndexList(){return[...this.searchInfo.matchCardSet].map((e=>e.index)).sort(((e,t)=>e-t))}},watch:{"btnInfo.openScrollSnap"(){this.btnInfo.openScrollSnap&&this.listInfo.unloadedIndexListInMatched.length<=0?this.scrollSnapType=null:this.scrollSnapType="none"}},methods:{getListInfo(){const e=this.$refs.list.getBoundingClientRect();this.$refs.list.querySelectorAll(".card").forEach((t=>{const n=t.getBoundingClientRect();this.twoRectsContains(e,n)?this.listInfo.visibleCardSet.add(this.cardInfoList[Number(t.dataset.index)]):this.listInfo.visibleCardSet.delete(this.cardInfoList[Number(t.dataset.index)])})),this.listInfo.visibleIndexListInMatched=[...this.listInfo.visibleCardSet].filter((e=>this.searchInfo.matchCardSet.has(e))).map((e=>e.index)).sort(((e,t)=>e-t)),this.listInfo.unloadedIndexListInMatched=[...this.listInfo.unloadedCardSet].filter((e=>this.searchInfo.matchCardSet.has(e))).map((e=>e.index)).sort(((e,t)=>e-t)),this.$emit("returnListInfo",this.listInfo)},initial_addGeneralAttributesForAllCards(){this.cardInfoList.forEach(((e,t)=>{e.index=t,e.showUrl=e.PicUrl,e.metaInfoAvailable=!1,e.verified=!1,e.Width>0&&e.Height>0?e.scale=e.Width/e.Height:e.scale=this.cardDefaultaspectRatio}))},twoRectsContains(e,t,n=0){const i=e.left,o=t.left,a=e.left+e.width,s=t.left+t.width,r=e.top,l=t.top,d=e.top+e.height,c=t.top+t.height;e.width,t.width,e.height,t.height;return r<l&&d>c&&i<o&&a>s},getMediaRatio(e){const t=this.cardDefaultaspectRatio,n=this.regex;return new Promise((function(i,o){if(null!=e&&""!=e)if(n.isVideo.test(e)){const n=document.createElement("video");n.src=e,n.oncanplay=function(){const e={state:"ok",width:n.videoWidth,height:n.videoHeight,scale:n.videoWidth/n.videoHeight};i(e)},n.onerror=function(){o({state:"error",width:0,height:0,scale:t})}}else{const n=new Image;if(n.src=e,n.complete){const e={state:"ok",width:n.width,height:n.height,scale:n.width/n.height};i(e)}else n.onload=()=>{const e={state:"ok",width:n.width,height:n.height,scale:n.width/n.height};i(e)},n.onerror=()=>{o({state:"error",width:1080*t,height:1080,scale:t})}}else{o({state:"error",width:1080*t,height:1080,scale:t})}}))},sendAlterBackGroundRequest(e,t=!1){this.$emit("alterBackGroundRequest",e,t)},getUnloadingIndexList({inputIndexList:e=[],limitedIndexList:t=[],mode:n="inner",startIndex:i=0,endIndex:o=0,count:a=-1,includeBounding:s=!1,toReturn:r=!1}){let l=new Set;"inner"==n&&e.forEach(((e,n)=>{let a=!1,d=t.indexOf(e);-1!=d&&(r&&(i<0&&(a=d>t.length-1+i&&d<=t.length-1||a),o>t.length-1&&(a=d>=0&&d<o-t.length-1||a)),a=s?d>=i&&d<=o||a:d>i&&d<o||a),a&&l.add(e)}));let d=Array.from(l).sort(((e,t)=>e-t));return-1!=a&&d.length>a&&(d=d.slice(0,a)),d},loadingQueue(e=500){let t=this.listInfo.loadingQueueList,n=0,i=this.onceLoadMaxCount/10;const o=async()=>{let a=async s=>{if(null==s)return;this.listInfo.loadedCardSet.add(s),this.listInfo.unloadedCardSet.delete(s);let r=[];if(s.verified)this.preViewIndex>=0&&(this.$refs.preViewer.toCenterThumbBox(),this.preViewIndex==s.index&&this.$refs.preViewer.toCenter());else if("img"===s.urlPicType||"video"===s.urlPicType)if(s.Width>0&&s.Height>0)s.scale=s.Width/s.Height,s.metaInfoAvailable=!0;else{s.Width=1080*this.cardDefaultaspectRatio,s.Height=1080;let e=this.getMediaRatio(s.PicUrl);r.push(e),e.then((e=>{s.Width=e.width,s.Height=e.height,s.scale=e.width/e.height,s.metaInfoAvailable=!0}),(e=>{s.metaInfoAvailable=!1}))}else s.Width=1080*this.cardDefaultaspectRatio,s.Height=1080,s.scale=this.cardDefaultaspectRatio,s.metaInfoAvailable=!1,s.verified=!0;Promise.all(r).finally((()=>{s.verified=!0,t.length?(n++,n>0&&n<10?i=this.onceLoadMaxCount/10*(n+1):n>=10&&(i=this.onceLoadMaxCount),setTimeout((()=>a(t.shift())),100)):(n=0,setTimeout(o,e)),this.preViewIndex>=0&&(this.$refs.preViewer.toCenterThumbBox(),this.preViewIndex==s.index&&this.$refs.preViewer.toCenter())}))};if(t.length)for(let e=0;e<t.length&&e<i;e++)a(t.shift());else n=0,i=this.onceLoadMaxCount/10,setTimeout(o,e)};o()},pollingLoading(){setInterval((()=>{this.getListInfo();let e=[...this.searchInfo.matchCardSet].map((e=>e.index));if(this.preViewIndex<0){if(this.listInfo.loadedCardSet.size<this.cardInfoList.length){const t=this.listInfo.visibleIndexListInMatched;let n=[],i=0,o=this.onceLoadMaxCount;if(t.length>0){let n=e.indexOf(t[0]),a=e.indexOf(t[t.length-1]);i=n-this.onceLoadMaxCount,o=a+this.onceLoadMaxCount}n=this.getUnloadingIndexList({inputIndexList:this.listInfo.unloadedIndexListInMatched,limitedIndexList:Array.from(this.searchInfo.matchCardSet).map((e=>e.index)),mode:"inner",targetParam:"value",startIndex:i,endIndex:o,count:this.onceLoadMaxCount,includeBounding:!0}),n<1&&this.btnInfo.slowLoading&&(n=this.getUnloadingIndexList({inputIndexList:this.listInfo.unloadedIndexListInMatched,limitedIndexList:Array.from(this.searchInfo.matchCardSet).map((e=>e.index)),mode:"inner",targetParam:"value",startIndex:0,endIndex:this.cardInfoList.length,count:.1*this.onceLoadMaxCount,includeBounding:!0})),this.verifyMultipleCard(n,!1)}}else{let t=e.indexOf(this.preViewIndex);startIndex=t-this.onceLoadMaxCount,endIndex=t+this.onceLoadMaxCount,listIndex=this.getUnloadingIndexList({inputIndexList:this.listInfo.unloadedIndexListInMatched,limitedIndexList:Array.from(this.searchInfo.matchCardSet).map((e=>e.index)),mode:"inner",targetParam:"value",startIndex:startIndex,endIndex:endIndex,count:this.onceLoadMaxCount,includeBounding:!0,toReturn:!0}),this.verifyMultipleCard(listIndex,!1)}this.btnInfo.openScrollSnap&&this.listInfo.unloadedIndexListInMatched.length<=0?this.scrollSnapType=null:this.scrollSnapType="none"}),1e3)},verifyMultipleCard(e,t=!0){if(t)this.listInfo.loadingQueueList.push(...e);else for(let t=0,n=e.length;t<n;t++)this.listInfo.loadingQueueList.push(this.cardInfoList[e[t]])},async verifySingleCardMandatory(e,t=(()=>{})){if(null==e)return;let n=[];if("img"===e.urlPicType||"video"===e.urlPicType){let t=this.getMediaRatio(e.PicUrl);n.push(t),t.then((t=>{e.Width=t.width,e.Height=t.height,e.scale=t.width/t.height,e.metaInfoAvailable=!0}),(t=>{e.metaInfoAvailable=!1}))}else e.Width=1080*this.cardDefaultaspectRatio,e.Height=1080,e.scale=this.cardDefaultaspectRatio,e.metaInfoAvailable=!1;Promise.all(n).finally((()=>{e.verified=!0,this.listInfo.loadedCardSet.add(e),this.listInfo.unloadedCardSet.delete(e),t()}))},reVerifyAllCard(){(()=>{this.listInfo.loadedCardSet.forEach((e=>{this.throttle(this.verifySingleCardMandatory(e),1e3)}))})()},loadingRemaining(){if(this.listInfo.loadedCardSet.size>=this.cardInfoList.length)return void alert("所有内容已加载！(若需要重新验证请点击“重新验证”按钮)");window.confirm("确认剩余加载所有?(如果内容数量过多可能造成严重卡顿，甚至卡死)")&&this.listInfo.loadingQueueList.push(...Array.from(this.listInfo.unloadedCardSet))},isChildOfTheSpecifiedClass(e,t){let n=null;return e.classList.contains(t)?n=e:e!=document.body&&(n=this.isChildOfTheSpecifiedClass(e.parentNode,t)),n},cardClickEvent(e){const t=window.event;0==t.button&&("A"!=t.target.tagName&&this.btnInfo.enableSwitchBackGround&&this.sendAlterBackGroundRequest(e),this.selectingInfo.cardSet.has(e)?(this.selectingInfo.cardSet.delete(e),this.selectingInfo.tempCardSet.delete(e)):(this.selectingInfo.cardSet.add(e),this.selectingInfo.tempCardSet.add(e)))},cardDblclickEvent(e){"A"!=window.event.target.tagName&&this.$refs.preViewer.toShow(e.index)},clickEventRight(){const e=window.event;if(2==e.button){const t=this.isChildOfTheSpecifiedClass(e.target,"card");if(null!=t){const n=this.cardInfoList[Number(t.dataset.index)];this.$refs.rightClickMenu.showMenu(e,n)}}},dragStart(e){const t=this.isChildOfTheSpecifiedClass(e.target,"card");this.dragSorting.index=t.dataset.index,this.dragSorting.tempTarget=t,this.dragSorting.targetIndex=Number(t.dataset.index),this.dragSorting.index},dragEnterOrLeave(e){const t=this;t.throttle(function(){const n=t.isChildOfTheSpecifiedClass(e.target,"card");if(null==n||n.dataset.index===t.dragSorting.index)return void(n.dataset.index===t.dragSorting.index&&null!=t.dragSorting.tempTargetIndicator&&(t.dragSorting.tempTargetIndicator.left.dataset.hover=!1,t.dragSorting.tempTargetIndicator.right.dataset.hover=!1));t.dragSorting.index!=n.dataset.index&&null!=t.dragSorting.tempTargetIndicator&&(t.dragSorting.tempTargetIndicator.left.dataset.hover=!1,t.dragSorting.tempTargetIndicator.right.dataset.hover=!1);let i=Number(n.dataset.index);if(null==i)return;t.dragSorting.tempTargetIndicator={left:n.querySelector(".card-mask-left"),right:n.querySelector(".card-mask-right")};let o=n.getBoundingClientRect();e.clientX<o.left+o.width/2?(t.dragSorting.tempTargetIndicator.left.dataset.hover=!0,t.dragSorting.tempTargetIndicator.right.dataset.hover=!1,t.dragSorting.index>i?t.dragSorting.targetIndex=i:t.dragSorting.targetIndex=i-1):(t.dragSorting.tempTargetIndicator.left.dataset.hover=!1,t.dragSorting.tempTargetIndicator.right.dataset.hover=!0,t.dragSorting.index>i?t.dragSorting.targetIndex=i+1:t.dragSorting.targetIndex=i)}(),1e4)},dragEnd(e){this.dragSorting.item=this.cardInfoList[this.dragSorting.index],this.cardInfoList.splice(this.dragSorting.index,1),this.cardInfoList.splice(this.dragSorting.targetIndex,0,this.dragSorting.item),this.dragSorting.index=null,this.dragSorting.item=null,null!=this.dragSorting.tempTargetIndicator&&(this.dragSorting.tempTargetIndicator.left.dataset.hover=!1,this.dragSorting.tempTargetIndicator.right.dataset.hover=!1,this.dragSorting.tempTargetIndicator)},selectionAll(e="all"){"all"===e&&this.cardInfoList.forEach((e=>{this.selectingInfo.cardSet.add(e),this.selectingInfo.tempCardSet.add(e)})),"nowWindowAll"===e&&this.searchInfo.matchCardSet.forEach((e=>{this.selectingInfo.cardSet.add(e),this.selectingInfo.tempCardSet.add(e)}))},cleanSelection(){this.selectingInfo.cardSet=new Set,this.selectingInfo.tempCardSet=new Set},clickEvent(e){this.$refs.rightClickMenu.closeMenu(e)},removeCard(e){this.$emit("requestRemoveCard",e)},debounce(e,t){let n;return function(){n&&clearTimeout(n),n=setTimeout((()=>{e()}),t)}},throttle(e,t){let n=Vue.ref(!0);return()=>{n.value&&(n.value=!1,setTimeout((()=>{e()}),t))}}},directives:{},mounted(){this.pollingLoading(),this.loadingQueue()},beforeMount(){},created(){},beforeCreate(){}},AppBackGroundBoard={template:'\n<div id="backGroundBoard" ref="backGroundBoard"\n:data-show-type="info.showType"\n:style="{\n\'background-image\':\'url(\'+ info.imgUrl +\')\',\n}"\n@mousewheel="wheelInViewer"\n>\n\x3c!-- 图片类背景用backGroundBoard容器自身显示 --\x3e\n\x3c!-- 视频类背景 --\x3e\n<video id="backgroundVideo" ref="backgroundVideo" controls loop="loop" autoplay="true"\n:src="info.videoUrl"\n></video>\n</div>\n',props:{regex:Object},data:()=>({info:{nsfw:!1,showType:"none",imgUrl:"",videoUrl:""}}),methods:{alterBackground(e){let t=!1;return this.regex.isImg.test(e)?(this.info.imgUrl=`'${e}'`,this.info.videoUrl="",this.info.showType="img",t=!0):this.regex.isVideo.test(e)?(this.info.videoUrl=e,this.info.imgUrl="",this.info.showType="video",t=!0):this.info.showType="none",t},wheelInViewer(e){"backgroundVideo"==e.target.id&&(e.wheelDelta>0?this.videoPlayerControl("volup"):this.videoPlayerControl("voldown"))},videoPlayerControl(e,t){const n=this.$refs.backgroundVideo;n.blur();const i=.1;let o=5;null!=t&&(o=t),"toback"==e&&(n.currentTime-o>0?n.currentTime=n.currentTime-o:n.currentTime=0),"toforward"==e&&(n.currentTime+o<n.duration?n.currentTime=n.currentTime+o:n.currentTime=n.duration),"voldown"==e&&(n.volume=n.volume-i>=0?n.volume-i:0),"volup"==e&&(n.volume=n.volume+i<=1?n.volume+i:1),"mute"==e&&(n.muted?n.muted=!1:n.muted=!0),"pause"==e&&n.pause(),"play"==e&&n.play(),"switch"==e&&(n.paused?n.play():n.pause())}},created(){if(config.initialBackgroundIndexByCard>=0)this.alterBackground(cardInfoList[config.initialBackgroundIndexByCard].PicUrl);else for(let e=0;e<cardInfoList.length&&"none"==this.info.showType;e++){const t=cardInfoList[e];let n=t.PicUrl;this.alterBackground(n)||(n=t.LinkUrl,this.alterBackground(n))}}},AppZoomBar={template:'\n<div id="zoomBar" data-show="true" \n@contextmenu.prevent.native="(e)=>{e.preventDefault()}">\n<input type="range" class="range" min="0" max="100.1" \nv-model="value" :step="100/maxColumn"\n@mousewheel.passive="wheel"\n>\n</div>\n',props:{maxColumn:Number},data:()=>({nowColumnInner:0}),methods:{wheel(e){let t=Math.round(this.value/100*this.maxColumn);e.wheelDelta>0?t--:t++,t>0?t<=this.maxColumn&&(this.nowColumn=t):this.nowColumn=0,this.value=this.nowColumn/this.maxColumn*100}},watch:{nowColumnInner(e,t){this.$emit("returnNowColumn",this.nowColumnInner)}},computed:{value:{get(){return this.nowColumnInner/this.maxColumn*100},set(e){this.nowColumnInner=Math.round(e/100*this.maxColumn)}}},mounted(){this.nowColumnInner=Math.round(this.maxColumn/2)}},AppNavBar={template:'\n<div id="navBarBox" @contextmenu.prevent.native="(e)=>{e.preventDefault()}">\n<div id="navBarBody">\n\x3c!-- 导航栏折叠框 --\x3e\n<div class="navBarCallBox">\n<div class="navBarCallButton" :data-unfold="unfold" @click="unfold=!unfold" >\n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8.28809 12L14.2981 18.01L15.7121 16.596L11.1121 11.996L15.7121 7.39601L14.2981 5.99001L8.28809 12Z" fill="black"/>\n</svg>\n</div>\n\n</div>\n\n\x3c!-- 加载状态栏 --\x3e\n<span id="cardLoadState" v-cloak>\n<div class="cardLoadMessage">\n{{loadingState.nowCount}}/{{loadingState.allCount}}</div>\n<div class="miniLoadingBar" :style="{width:getPercentage}"></div>\n</span>\n\x3c!-- 选择信息状态栏 --\x3e\n<span id="cardSelectedCount" v-cloak>{{selectingInfo.nowCount}}</span>\n\n\n\x3c!-- 导航按钮列表 --\x3e\n<div id="navbar">\n<button id="allSelection" type="button"\n@click="sendAllSelectRequest(\'all\')">\n全选\n</button>\n<button id="allSelectionNow" type="button"\n@click="sendAllSelectRequest(\'nowWindowAll\')">\n全选当前\n</button><hr>  \n<button id="cleanSelection" type="button"\n@click="sendCleanSelectionRequest">\n清空选择\n</button>\n<button id="getSelectedUrlInfo" type="button">\n获取链接\n</button>\n<button id="downloadSelectedInQuicker" type="button" \nv-if="info.openQuickerInteraction"\n@click="sendDownloadRequest">\n下载选中\n</button>\n<br>\n<button id="toNormalMode" \nv-if="info.openQuickerInteraction"\n@click="sendToNormalModeRequest">\n普通模式\n</button><br>\n<button id="allReVerify" type="button" @click="sendReVerifyAllCardRequest">\n全部重验证\n</button>\n<div id="once-loading-count-options-box">\n单次加载数量\n<select id="once-loading-count-options-box-select" \nv-model="getOnceLoadingMax">\n<option v-bind:value="10">10条</option>\n<option v-bind:value="20">20条</option>\n<option v-bind:value="30">30条</option>\n<option v-bind:value="40">40条</option>\n<option v-bind:value="50">50条</option>\n<option v-bind:value="60">60条</option>\n<option v-bind:value="70">70条</option>\n<option v-bind:value="80">80条</option>\n<option v-bind:value="90">90条</option>\n<option v-bind:value="100">100条</option>\n<option v-bind:value="200">200条</option>\n<option v-bind:value="300">300条</option>\n<option v-bind:value="400">400条</option>\n<option v-bind:value="500">500条</option>\n</select>\n</div>\n<button id="slowLoading" type="button" \n:data-value="btn.slowLoading"\n@click="btn.slowLoading = !btn.slowLoading">\n缓慢加载<hr>\n</button>\n<button id="loadingRemaining" type="button"\n@click="sendLoadingRemainingRequest">\n加载剩余项\n</button><br>\n<button id="NSFWModeSwitch" type="button" \n:data-value="btn.NSFWMode" \n@click="btn.NSFWMode = !btn.NSFWMode">\nNSFW模式<hr>\n</button>\n<button id="cardTitleShowSwitch" type="button" \n:data-value="btn.cardTitleShow"\n@click="btn.cardTitleShow = !btn.cardTitleShow">\n卡片标题<hr>\n</button>\n<button id="enableSwitchBackGround" type="button"\n:data-value="btn.enableSwitchBackGround"\n@click="btn.enableSwitchBackGround = !btn.enableSwitchBackGround">\n背景切换<hr>\n</button>\n<button id="openScrollSnap" type="button"\n:data-value="btn.openScrollSnap"\n@click="btn.openScrollSnap = !btn.openScrollSnap">\n滚动吸附<hr>\n</button>\n<button id="listPageShowSwitch" type="button"\n:data-value="btn.listPageShow" \n@click="btn.listPageShow = !btn.listPageShow">\n画廊切换<hr>\n</button>\n</div>\n</div>\n\n</div>\n',props:{onceLoadMaxCount:Number,loadingState:Object,selectingInfo:Object},emits:["returnBtnInfo","returnOnceLoadingMax","downloadRequest","reVerifyAllCard","toNormalMode","allSelectRequest","cleanSelectionRequest","loadingRemainingRequest"],computed:{getPercentage(){return 0==this.loadingState.nowCount||0==this.loadingState.allCount?"0%":this.loadingState.nowCount/this.loadingState.allCount*100+"%"},getOnceLoadingMax:{get(){return this.onceLoadMaxCount},set(e){this.$emit("returnOnceLoadingMax",e)}}},data:()=>({unfold:!0,info:{openQuickerInteraction:config.openQuickerInteraction},btn:{slowLoading:!1,NSFWMode:config.initNSFWState,cardTitleShow:config.initCardTitleState,enableSwitchBackGround:config.initClickSwBackgroundState,openScrollSnap:config.initOpenScrollSnap,listPageShow:!0}}),watch:{btn:{handler(e,t){this.$emit("returnBtnInfo",{slowLoading:e.slowLoading,enableSwitchBackGround:e.enableSwitchBackGround,openScrollSnap:e.openScrollSnap})},deep:!0}},methods:{sendDownloadRequest(){this.$emit("downloadRequest")},sendToNormalModeRequest(){this.$emit("toNormalMode")},sendReVerifyAllCardRequest(){this.$emit("reVerifyAllCard")},sendAllSelectRequest(e){this.$emit("allSelectRequest",e)},sendCleanSelectionRequest(){this.$emit("cleanSelectionRequest")},sendLoadingRemainingRequest(){this.$emit("loadingRemainingRequest")}},created(){this.$emit("returnBtnInfo",{slowLoading:this.btn.slowLoading,enableSwitchBackGround:this.btn.enableSwitchBackGround,openScrollSnap:this.btn.openScrollSnap})}},AppHeaderBar={template:'\n<div class="header">\n\x3c!-- 标题拖拽块 --\x3e\n<div class="titleDragBlock"\n:style="{\n\'app-region\': \'drag\',\n}"\n>{{title}}\n\x3c!-- 关闭按钮 --\x3e\n<button id="closeWindow" @click="closeWindow" :style="{\'app-region\': \'none\'}">\n<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C9.34711 22.0024 6.80218 20.9496 4.9263 19.0737C3.05042 17.1978 1.99762 14.6529 2 12V11.8C2.08179 7.79223 4.5478 4.22016 8.26637 2.72307C11.9849 1.22597 16.2381 2.0929 19.074 4.92601C21.9365 7.78609 22.7932 12.0893 21.2443 15.8276C19.6955 19.5659 16.0465 22.0024 12 22ZM12 13.41L14.59 16L16 14.59L13.41 12L16 9.41001L14.59 8.00001L12 10.59L9.41001 8.00001L8.00001 9.41001L10.59 12L8.00001 14.59L9.41001 16L12 13.411V13.41Z"/>\n</svg>\n</button>\n\x3c!-- 窗口加载进度条 --\x3e\n<div id="loadProgressBox" \n:data-percentage="percentage" \n:data-loaded="loaded">\n<div class="progressBar" :style="{width:percentage}"></div>\n</div>\n</div>\n\n\n</div>\n',props:{title:{type:String,default:"图库"},nowCount:Number,allCount:Number},data:()=>({loaded:!1}),watch:{nowCount(e,t){e>=this.allCount&&setTimeout((()=>{this.loaded=!0}),2e3)}},computed:{percentage(){return 0==this.nowCount||0==this.allCount?"0%":this.nowCount/this.allCount*100+"%"}},methods:{closeWindow(){window.close()}}},AppListPage={components:{AppList:AppList,AppBackGroundBoard:AppBackGroundBoard,AppZoomBar:AppZoomBar,AppNavBar:AppNavBar,AppHeaderBar:AppHeaderBar},template:'\n\x3c!-- 背景板 --\x3e\n<app-back-ground-board ref="backGroundBoard"\n:regex="regex"\n></app-back-ground-board>\n\x3c!-- 页面头部 --\x3e\n<app-header-bar\n:title="title"\n:allCount="cardInfoList.length"\n:nowCount="listInfo.loadedCardSet.size"\n></app-header-bar>\n\x3c!-- 中间主体区域 --\x3e\n<div class="body">\n\x3c!-- 左侧导航栏 --\x3e\n<app-nav-bar\n:onceLoadMaxCount="onceLoadMaxCount"\n@returnOnceLoadingMax="(value)=>{onceLoadMaxCount = value}"\n@returnBtnInfo="(value)=>{btnInfo = value}"\n@downloadRequest="downloadToQuicker"\n@toNormalMode="toNormalMode"\n@reVerifyAllCard="()=>{$refs.list.reVerifyAllCard()}"\n@allSelectRequest="(value)=>{$refs.list.selectionAll(value)}"\n@cleanSelectionRequest="()=>{$refs.list.cleanSelection()}"\n@loadingRemainingRequest="()=>{$refs.list.loadingRemaining()}"\n:loadingState="{\nnowCount:listInfo.loadedCardSet.size,\nallCount:cardInfoList.length,\n}"\n:selectingInfo="{\nnowCount:selectingInfo.tempCardSet.size\n}"\n></app-nav-bar>\n\x3c!-- 列表区域 --\x3e\n<app-list ref="list"\n:cardInfoList="cardInfoList"\n:cardDefaultaspectRatio="cardDefaultaspectRatio"\n:regex="regex"\n:nowColumn="nowColumn"\n:onceLoadMaxCount="onceLoadMaxCount"\n:btnInfo="btnInfo"\n:selectingInfo="selectingInfo"\n@returnListInfo="(value)=>{listInfo = value}"\n@alterBackGroundRequest="setBackGround"\n@requestRemoveCard="removeCard"\n></app-list>\n\n\x3c!-- 右侧缩放条 --\x3e\n<app-zoom-bar \n:maxColumn="maxColumn"\n@returnNowColumn="(value)=>{nowColumn = value}"\n></app-zoom-bar>\n</div>\n\n',data:()=>({title:config.title,openDragBlock:!0,cardInfoList:cardInfoList,cardInfoListBackup:Array.from(cardInfoList),cardDefaultaspectRatio:9/16,listInfo:{loadingQueueList:[],visibleCardSet:new Set,loadedCardSet:new Set,unloadedCardSet:new Set,visibleIndexListInMatched:[],unloadedIndexListInMatched:[]},selectingInfo:{cardSet:new Set,tempCardSet:new Set},btnInfo:{slowLoading:!1,enableSwitchBackGround:config.initClickSwBackgroundState,openScrollSnap:config.initOpenScrollSnap},onceLoadMaxCount:config.initLoadingCount,maxColumn:config.maxColumn,nowColumn:config.maxColumn/2,initialBackgroundIndexByCard:config.initialBackgroundIndexByCard,initialBackgroundCard:null,regex:{isImg:/^.+?\.(png|jpg|jpeg|gif|webp|bmp)/i,isGif:/^.+?\.(gif)/i,isVideo:/^.+?\.(mp4|avi|mov|webm|mkv|flv)/i}}),methods:{initial_addGeneralAttributesForAllCards(){this.cardInfoList.forEach(((e,t)=>{e.index=t,e.showUrl=e.PicUrl,e.metaInfoAvailable=!1,e.verified=!1,e.Width>0&&e.Height>0?e.scale=e.Width/e.Height:e.scale=this.cardDefaultaspectRatio}))},setBackGround(e,t=!1){if(null!=e){let n=null;this.regex.isImg.test(e.LinkUrl)||this.regex.isVideo.test(e.LinkUrl)?n=e.LinkUrl:(this.regex.isImg.test(e.PicUrl)||this.regex.isVideo.test(e.PicUrl))&&(n=e.PicUrl),null!=n&&(this.$refs.backGroundBoard.alterBackground(n),t&&(this.initialBackgroundCard=e))}},removeCard(e){let t=this.cardInfoList.findIndex((t=>e===t));this.cardInfoList.splice(t,1),this.listInfo.loadedCardSet.delete(e),this.listInfo.unloadedCardSet.delete(e),this.selectingInfo.cardSet.delete(e),this.selectingInfo.tempCardSet.delete(e),this.$refs.list.searchInfo.matchCardSet.delete(e)},returnToQuicker(e,t){chrome.webview.hostObjects.sync.v.setVar(e,t)},downloadToQuicker(){this.returnToQuicker("jsonListSelected",this.getJsonList()),this.returnToQuicker("nextStep","download"),window.close()},toNormalMode(){this.returnToQuicker("jsonListSelected",this.getJsonList()),this.returnToQuicker("nextStep","switchNormalMode"),window.close()},getJsonList(){let e;e=this.selectingInfo.cardSet.size<1?this.cardInfoList:[...this.selectingInfo.cardSet];let t="";for(let n=0,i=e.length;n<i;n++){const i=e[n];let o={Width:0,Height:0,scale:0};i.metaInfoAvailable&&(o.Width=i.Width,o.Height=i.Height,o.scale=i.scale);t+=`${JSON.stringify(String(i.id))}:{\n"id": ${JSON.stringify(i.id)},\n"index": ${JSON.stringify(n)},\n"Content": ${JSON.stringify(i.Content)},\n"LinkUrl": ${JSON.stringify(i.LinkUrl)},\n"PicUrl": ${JSON.stringify(i.PicUrl)},\n"urlType": ${JSON.stringify(i.urlType)},\n"urlPicType": ${JSON.stringify(i.urlPicType)},\n"Width":${JSON.stringify(o.Width)},\n"Height":${JSON.stringify(o.Height)},\n"scale":${JSON.stringify(o.scale)},\n}`,n+1<e.length&&(t+=",")}return t=`{${t}}`,t}},computed:{giveInfoToList(){return{cardInfoList:this.cardInfoList}}},directives:{},mounted(){this.intiOK=!0},created(){this.initial_addGeneralAttributesForAllCards()}};